## Изменение последнего коммита: `git commit --amend`

---

Команда `git commit --amend` — это удобный способ изменить последний коммит. Она позволяет объединить проиндексированные изменения с предыдущим коммитом без создания нового коммита. Ее можно использовать для редактирования комментария к предыдущему коммиту без изменения состояния кода в нем. Но такое изменение не только редактирует последний коммит, но и полностью его заменяет. То есть измененный коммит станет новой сущностью с отдельной ссылкой. Для Git он будет выглядеть как новый коммит, который отмечен звездочкой (\*) на схеме внизу. Существует несколько распространенных сценариев использования команды `git commit --amend`. В следующих разделах мы расскажем о примерах ее использования.

![Git commit amend](https://wac-cdn.atlassian.com/dam/jcr:34fd0826-9e89-4ef1-bce8-b1325cf48306/01-02%20Changing%20the%20Last%20Commit.svg?cdnVersion=1492)

### Изменение комментария к последнему коммиту Git 

```zsh terminal
git commit --amend
```

Допустим, при выполнении коммита вы допустили ошибку в комментарии к нему. Выполнение этой команды в отсутствие проиндексированных файлов позволяет отредактировать комментарий к предыдущему коммиту без изменения состояния кода.

В процессе разработки регулярно случаются преждевременные коммиты. Очень просто забыть проиндексировать файл или использовать неправильный формат комментария к коммиту. Флаг `--amend` позволяет удобно исправить эти небольшие ошибки.

```zsh terminal
git commit --amend -m "an updated commit message"
```

Добавление аргумента `-m` позволяет передать новый комментарий из командной строки, не открывая текстовый редактор.

### Изменение файлов после коммита 

В следующем примере показан распространенный сценарий разработки с использованием Git. Допустим, вы отредактировали несколько файлов и хотите сделать коммит за одну операцию. Но потом выясняется, что вы забыли добавить один из файлов в самом начале. Для того чтобы исправить эту ошибку, достаточно проиндексировать другой файл и выполнить коммит с флагом `--amend`:

```zsh terminal
# Edit hello.py and main.py
git add hello.py
git commit 
# Realize you forgot to add the changes from main.py 
git add main.py 
git commit --amend --no-edit
```

Флаг `--no-edit` позволит внести изменения в коммит без изменения комментария к нему. Итоговый коммит заменит неполный коммит. При этом все будет выглядеть так, словно изменения в файлах `hello.py` и `main.py` были сделаны за один коммит.

### Не используйте amend для публичных коммитов 

Измененные коммиты по сути являются новыми коммитами. При этом предыдущий коммит не останется в текущей ветке. Последствия этой операции аналогичны сбросу (reset) публичного состояния кода. Не изменяйте коммит, после которого уже начали работу другие разработчики. Эта ситуация только запутает разработчиков, и разрешить ее будет непросто.

### Обзор 

Если коротко, команда `git commit --amend` позволяет добавить новые проиндексированные изменения в последний коммит. С помощью коммита `--amend` можно добавлять изменения в индекс Git или удалять таковые из него. Если никаких изменений не проиндексировано, при использовании флага `--amend` вам все равно будет предложено изменить комментарий к последнему коммиту. Будьте осторожны при использовании флага `--amend` с коммитами, доступными другим членам команды. Изменение коммита, доступного другому пользователю, может привести к путанице и длительным устранениям конфликтов при слиянии.